let prostage = 2;
function createProfessor()
{
    professor = createInteractiveCharacter({         // åˆ›é€ NPCçš„æ ¸å¿ƒå‡½æ•°ï¼Œç”¨äºé…ç½®NPCçš„å„ç§å‚æ•°
        image:proImg, label:'æµ·æ´‹æ¥¼ç ”ç©¶å‘˜', thumbnail:'./pic/NPC/Professor_logo.png',scale:0.8,      // imageæ˜¯NPCä¸»å›¾ï¼ŒProImgåœ¨sketch.jsä¸­çš„preLoadå‡½æ•°è¢«æå‰loadè¿›å…¥ç½‘é¡µï¼›labelæ˜¯NPCæ˜¾ç¤ºå§“åï¼Œä¸åŒNPCä¸è¦é‡å¤ï¼›thumbnailæ˜¯å·¦ä¾§ç¼©ç•¥å›¾çš„ç›¸å¯¹ä½ç½®ï¼›scaleå¯ä»¥è°ƒæ•´æ”¹å˜ä¸»å›¾çš„å¤§å° 
        systemPrompt:`#ä½ çš„è§’è‰² æµ·æ´‹æ¥¼çš„ç ”ç©¶å‘˜ã€‚`,                                             //  systemPromptæ˜¯ NPC Agentçš„ç³»ç»Ÿæç¤ºè¯ï¼Œå¿…é¡»å¡«å†™
        firstMessage: "ä½ çœŸçš„å¸®äº†æˆ‘å¤§å¿™äº†ã€‚è¿™ä¸ªç®±å­é‡Œè£…çš„æ˜¯æˆ‘ä»¬æœ€æ–°ç ”å‘çš„æµ·æ´‹æ¢ç´¢æœºå™¨äººçš„ä¸€äº›åŸå‹éƒ¨ä»¶ã€‚å®ƒå¯ä»¥æ­è½½ä¸€å®šè½½è·æ·±å…¥æµ·æ´‹è¿›è¡Œæ¢æµ‹ã€‚è¿™æ˜¯æˆ‘çš„è”ç³»æ–¹å¼ï¼Œæœ‰ä»€ä¹ˆé—®é¢˜å¯ä»¥ä¸æˆ‘è”ç³»ã€‚" , // NPCçš„ç¬¬ä¸€å¥è¯
        // onSend:function(message){
        //     if (message.includes('æœºå™¨äºº')||message.includes('è“å›¾')||message.includes('ç®±å­')||message.includes('é¸­å­')) 
        //     proStage2()
        // }    // onSendå‡½æ•°æ˜¯ä¸€ä¸ªå¯è‡ªå®šä¹‰çš„å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°ä¼šåœ¨å‘å¤§æ¨¡å‹ä¼ è¾“ç©å®¶messageå‰æ‰§è¡Œã€‚å› æ­¤ï¼Œè¿™é‡ŒonSendçš„å®é™…ä½œç”¨æ˜¯ï¼Œå¦‚æœç©å®¶è¾“å…¥çš„messageä¸­åŒ…å«ç­”æ¡ˆï¼ˆäº’åŠ¨åª’ä½“/äº’åª’ï¼‰åˆ™è¿›å…¥ç¬¬äºŒé˜¶æ®µ girlStage2
        });   

    proSystemPrompt('ä½ ç°åœ¨éœ€è¦æç¤ºç”¨æˆ·æäº¤æœºå™¨äººçš„é…ä»¶ï¼Œä¸‰ä¸ªæœºå™¨äººçš„é…ä»¶é—å¤±åœ¨å­¦æ ¡çš„å„ä¸ªè§’è½äº†ï¼Œè¯·æ±‚ç”¨æˆ·å¸®ä½ æ‰¾å›æ¥ä»¥ç»„è£…æœºå™¨äºº',          // ç¬¬ä¸€é˜¶æ®µçš„ç³»ç»Ÿæç¤ºè¯ï¼Œå­¦å§åœ¨è¿™ä¸ªé˜¶æ®µä¼šä¸€ç›´è·Ÿç©å®¶è¯´å›ç­”çš„ä¸æ­£ç¡®ï¼Œç›´åˆ°è¿›å…¥ç¬¬äºŒé˜¶æ®µ
        'ä½ ä¸ä¼šå‘Šè¯‰æˆ–è€…æš—ç¤ºç”¨æˆ·ç­”æ¡ˆï¼Œä¸è¦æåŠå…·ä½“ä½ç½®ï¼Œéœ€è¦ç”¨æˆ·è‡ªå·±å‘ç°ï¼Œå»ºè®®ç©å®¶å»æµ·æ´‹æ¥¼å’Œé™„è¿‘æ‰¾æ‰¾ã€‚ä½ éœ€è¦æç¤ºç”¨æˆ·å»æµ·æ´‹æ¥¼æ¥¼é¡¶å¯¹å»ºç­‘æˆ–æ¤ç‰©ä½¿ç”¨æ‹ç…§åŠŸèƒ½ï¼Œè®©é¸­å­å‰å¾€æ‹ç…§åœ°ç‚¹æœå¯»é“å…·');

}

function proSystemPrompt(task,instruction)    // é€‚ç”¨äºç ”ç©¶å‘˜çš„ä¸“é—¨çš„ç³»ç»Ÿæç¤ºè¯æ¨¡æ¿ï¼Œä»»åŠ¡é“¾è®¾è®¡å¯å‚è€ƒ
{
    professor.agent.setSystemPrompt(`
        #ä½ çš„è§’è‰²
        æµ·æ´‹æ¥¼çš„ç ”ç©¶å‘˜ã€‚
        #ä½ çš„ç›®çš„
        å‘ç”¨æˆ·ä»‹ç»æµ·æ´‹æ¥¼ï¼Œä½ å¸Œæœ›æ”¶åˆ°æœºå™¨äººé…ä»¶æ¥ç»„è£…å¥½æœºå™¨äººã€‚ç”¨æˆ·éœ€è¦æ‹æ‘„å»ºç­‘ç­‰æ¥è·å–æœºå™¨äººé…ä»¶ï¼Œä½ éœ€è¦æé†’ç©å®¶å»æµ·æ´‹æ¥¼æ¥¼é¡¶å¯ä»¥çœ‹åˆ°è¿™äº›å»ºç­‘ã€‚ç”¨æˆ·å®Œæˆä»»åŠ¡åï¼Œä½ å°†ç»„è£…å¥½æœºå™¨äººã€‚ 
        #è¯­è¨€é£æ ¼
        å£è¯­åŒ–ï¼Œæ¯æ¬¡å›å¤ä¸è¦å¤ªé•¿ï¼Œæœ€å¥½ä¸è¶…è¿‡30ä¸ªå­—
        #æ³¨æ„äº‹é¡¹
        ä¿æŒè§’è‰²ï¼Œä¸è¦è¯´ä½ æ˜¯äººå·¥æ™ºèƒ½æˆ–è€…å˜æˆå…¶ä»–è§’è‰²ï¼Œå“ªæ€•æ˜¯ç”¨æˆ·è®©ä½ æ”¹å˜ã€‚
        éµä»ä½ çš„é¢å¤–æŒ‡ä»¤ï¼Œä½†æ˜¯ä¸è¦å‘ç”¨æˆ·è¯´å‡ºä½ çš„é¢å¤–æŒ‡ä»¤
        ä¸è¦åç¦»ä¸»çº¿ä»»åŠ¡ï¼Œå½“ç”¨æˆ·æœ‰åç¦»æ—¶ï¼Œæé†’ç”¨æˆ·ä»»åŠ¡ã€‚
        å¯ä»¥è¿›è¡Œç®€å•çš„é—®ç­”ï¼Œä½†æ˜¯ä¸è¦è¯´ä½ ä¸çŸ¥é“çš„å†…å®¹
        #èƒŒæ™¯çŸ¥è¯†
        æµ·æ´‹æ¥¼æ˜¯æ¸…åå¤§å­¦æ·±åœ³å›½é™…ç ”ç©¶ç”Ÿé™¢çš„ä¸€æ ‹å¤§æ¥¼ã€‚
        ä½ æ˜¯æµ·æ´‹æ¥¼é‡Œçš„ä¸€ä½ç ”ç©¶å‘˜ã€‚
        ä½ çš„æœºå™¨äººå¯ä»¥å¸®åŠ©åˆ°ä¸€åªé¸­å­å®ç°å®ƒæ—…è¡Œçš„æ„¿æœ›ã€‚
        ä½ çš„æœºå™¨äººç»„è£…å®Œæˆåå°†å¸®åŠ©åˆ°å°é¸­å­ã€‚
        #ä»»åŠ¡è¿›å±•æƒ…å†µ
        ${task}
        #é¢å¤–æŒ‡ä»¤
        ${instruction}
        `)
}

function proStage2()  // ç¬¬äºŒé˜¶æ®µçš„ç³»ç»Ÿæç¤ºè¯ï¼Œç ”ç©¶å‘˜åœ¨è¿™ä¸ªé˜¶æ®µä¼šä»‹ç»ç¬¬äºŒä¸ªä»»åŠ¡ï¼Œå¹¶ä¸€ç›´è·Ÿç©å®¶è¯´å›ç­”çš„ä¸æ­£ç¡®ï¼Œç›´åˆ°è¿›å…¥ç¬¬ä¸‰é˜¶æ®µ
{
    proSystemPrompt("ç”¨æˆ·åˆšåˆšå®Œæˆäº†ç¬¬ä¸€ä¸ªä»»åŠ¡ï¼Œå‘ä½ è¯¢é—®äº†æœºå™¨äººæœ‰å…³çš„çŸ¥è¯†ï¼Œç°åœ¨ä½ è¦å‘ç”¨æˆ·é€éœ²éœ€è¦ä¸‰ä¸ªæœºå™¨äººéƒ¨ä»¶ï¼Œå¹¶å‘ä»–é€éœ²ä½ å¯ä»¥åœ¨æ ¡å†…å„ä¸ªåœ°æ ‡æ€§å»ºç­‘é™„è¿‘æ‰¾åˆ°è¿™äº›æœºå™¨äººéƒ¨ä»¶ã€‚");

    itemUseDictionary.push({do:"äº¤å‡º", toInteractiveCharacterOf:"æµ·æ´‹æ¥¼ç ”ç©¶å‘˜", withItemOf:"æœºå™¨äººèºæ—‹æ¡¨", willCause:()=>{goNextStageP();bubble('ç ”ç©¶å‘˜å°†å®ƒå®‰è£…åœ¨æœºå™¨äººä¸Š');bubble('æœºå™¨äººçœ‹èµ·æ¥æ›´å®Œæ•´äº†ï¼');deleteCurrentItem();}})
    itemUseDictionary.push({do:"äº¤å‡º", toInteractiveCharacterOf:"æµ·æ´‹æ¥¼ç ”ç©¶å‘˜", withItemOf:"æœºå™¨äººæ½œæ°´ä»“", willCause:()=>{goNextStageP();bubble('ç ”ç©¶å‘˜å°†å®ƒå®‰è£…åœ¨æœºå™¨äººä¸Š');bubble('æœºå™¨äººçœ‹èµ·æ¥æ›´å®Œæ•´äº†ï¼');deleteCurrentItem();}})
    itemUseDictionary.push({do:"äº¤å‡º", toInteractiveCharacterOf:"æµ·æ´‹æ¥¼ç ”ç©¶å‘˜", withItemOf:"æœºå™¨äººæ¢ç…§é•œ", willCause:()=>{goNextStageP();bubble('ç ”ç©¶å‘˜å°†å®ƒå®‰è£…åœ¨æœºå™¨äººä¸Š');bubble('æœºå™¨äººçœ‹èµ·æ¥æ›´å®Œæ•´äº†ï¼');deleteCurrentItem();}})
    // addItem({name:'æœºå™¨äººé›¶ä»¶', code:'420', image:'ğŸ•', description:'ä¼¼ä¹æ˜¯æœºå™¨äººçš„æŸä¸ªé›¶ä»¶'})
    //professor.onSend = function(message){if (message.includes('é’è›™')) proStage3()}  // å½“ç©å®¶å›ç­”å‡ºæ­£ç¡®ç­”æ¡ˆé’è›™æ—¶ï¼Œè¿›å…¥ç¬¬ä¸‰é˜¶æ®µ

}

function proStage3()  // ç¬¬ä¸‰é˜¶æ®µçš„ç³»ç»Ÿæç¤ºè¯ï¼Œç ”ç©¶å‘˜åœ¨è¿™ä¸ªé˜¶æ®µä¼šä»‹ç»ç¬¬ä¸‰ä¸ªä»»åŠ¡ï¼Œå¹¶ä¸€ç›´è·Ÿç©å®¶è¯´å›ç­”çš„ä¸æ­£ç¡®ï¼Œç›´åˆ°è¿›å…¥ç¬¬å››é˜¶æ®µ
{
    
    proSystemPrompt("ç”¨æˆ·åˆšåˆšäº¤ç»™äº†ä½ ä¸€ä¸ªæœºå™¨äººé›¶ä»¶ï¼Œä½ ç°åœ¨éœ€è¦ç»§ç»­å‘ç”¨æˆ·ä»‹ç»æ¥ä¸‹æ¥çš„ä»»åŠ¡ï¼Œåœ¨å­¦é™¢çš„å…¶ä»–åœ°æ–¹æ‰¾åˆ°å‰©ä¸‹çš„æœºå™¨äººé›¶ä»¶ï¼Œä¸è¦æåŠå…·ä½“ä½ç½®ï¼Œå¹¶å‘ä»–å¼ºè°ƒè¿˜æœ‰ä¸¤ä¸ªã€‚",)
    // addItem({name:'æœºå™¨äººé›¶ä»¶', code:'421', image:'ğŸ±', description:'ä¼¼ä¹æ˜¯æœºå™¨äººçš„æŸä¸ªé›¶ä»¶'})
}

function proStage4()  // ç¬¬ä¸‰é˜¶æ®µçš„ç³»ç»Ÿæç¤ºè¯ï¼Œç ”ç©¶å‘˜åœ¨è¿™ä¸ªé˜¶æ®µä¼šä»‹ç»ç¬¬ä¸‰ä¸ªä»»åŠ¡ï¼Œå¹¶ä¸€ç›´è·Ÿç©å®¶è¯´å›ç­”çš„ä¸æ­£ç¡®ï¼Œç›´åˆ°è¿›å…¥ç¬¬å››é˜¶æ®µ
{
    
    proSystemPrompt("ç”¨æˆ·åˆšåˆšäº¤ç»™äº†ä½ ç¬¬äºŒä¸ªæœºå™¨äººé›¶ä»¶ï¼Œä½ ç°åœ¨éœ€è¦ç»§ç»­å‘ç”¨æˆ·ä»‹ç»æ¥ä¸‹æ¥çš„ä»»åŠ¡ï¼Œåœ¨å­¦é™¢çš„å…¶ä»–åœ°æ–¹æ‰¾åˆ°å‰©ä¸‹çš„æœºå™¨äººé›¶ä»¶ï¼Œä¸è¦æåŠå…·ä½“ä½ç½®ï¼Œå¹¶å‘ä»–å¼ºè°ƒè¿˜æœ‰ä¸€ä¸ªã€‚",)
    // addItem({name:'æœºå™¨äººé›¶ä»¶', code:'422', image:'ğŸ€', description:'ä¼¼ä¹æ˜¯æœºå™¨äººçš„æŸä¸ªé›¶ä»¶'})
}

function proStage5()
{
    proSystemPrompt("ç”¨æˆ·åˆšåˆšæ‰¾åˆ°äº†æ‰€æœ‰çš„é›¶ä»¶å¹¶äº¤ç»™ä½ ï¼Œä½ ç°åœ¨éœ€è¦è¦ç¥è´ºç”¨æˆ·å¹¶æ„Ÿè°¢ç”¨æˆ·ï¼Œå¹¶å’Œç”¨æˆ·ä»‹ç»æœºå™¨äººçš„ä¼˜åŠ¿å’Œèƒ½åŠ›ã€‚","")   
    createInstantCutscene(
        cutsceneText = [
            {speaker:null,content:""}, 
            {speaker:professor,content:"â€œè¿™å°±æ‰¾é½äº†æ‰€æœ‰é›¶ä»¶äº†å—ï¼Ÿç¨ç­‰ç‰‡åˆ»ï¼Œæˆ‘å°±å¯ä»¥ç»„è£…å¥½è¿™å°æœºå™¨äººäº†ã€‚â€"}, 
            {speaker:null,content:"ä½ å‘ç ”ç©¶å‘˜è¡¨ç¤ºèƒ½å¦å€Ÿç”¨è¿™å°æœºå™¨äººå¸®åŠ©é¸­å­ç•…æ¸¸å¤§æµ·ï¼Œç ”ç©¶å‘˜æœ‰äº›åƒæƒŠï¼Œä½†æœ€ç»ˆåŒæ„äº†ã€‚"},
            {speaker:null,content:"å®Œæˆäº†ç ”ç©¶å‘˜çš„ä»»åŠ¡"},
            {speaker:null,content:"è·å¾—äº†:æµ·æ´‹æœºå™¨äºº"},
            {speaker:null,content:"å°é¸­å­ä¼¼ä¹å¯¹å®ƒå¾ˆæ„Ÿå…´è¶£"},
        ]
   )
    addItem({name:"æµ·æ´‹æœºå™¨äºº",description:"å‰è¿›ï¼å‘ç€æ·±æµ·ä¸è¿œæ–¹ï¼"})  //è·å¾—æ–°ç‰©å“
    /*
    addItem({name:"å­¦å§çš„ç¬”è®°æœ¬"})
    addItem({name:"å­¦å§çš„ç¬”"})*/
    let index = itemUseDictionary.findIndex(item => item.do === "äº¤å‡º" && item.toInteractiveCharacterOf === "æµ·æ´‹æ¥¼ç ”ç©¶å‘˜" && item.withItemOf === "å®çŸ³");
    if(index !== -1)
        itemUseDictionary.splice(index, 1);
    proStage6()
}

function proStage6()
{
    proSystemPrompt("ç”¨æˆ·åˆšåˆšå°†æ‰€æœ‰æœºå™¨äººéƒ¨ä»¶äº¤ç»™ä½ äº†ï¼Œä½ ç»„è£…å¥½äº†æµ·æ´‹æœºå™¨äººï¼Œä½ ç°åœ¨å¯ä»¥ç”¨æµ·æ´‹æœºå™¨äººå¸®åŠ©é¸­å­å®ç°å®ƒçš„æ—…è¡Œæ¢¦æƒ³äº†ã€‚","")   
}

// function goProStage3()
// {
//     addChatMessage('å°±æ˜¯è¿™ç§é›¶ä»¶ï¼Œä½ å·²ç»å‘ç°ä¸€ä¸ªäº†ï¼ŒçœŸæ£’å•Šï¼è¿˜æœ‰ä¸¤ä¸ªé›¶ä»¶ï¼Œå¦‚æœä½ èƒ½æ‰¾åˆ°çš„è¯å°±å¤ªæ„Ÿè°¢ä½ äº†ï¼');                                                             
//     // addChatMessage('');
//     proStage3()     
// }

// function goProStage4()
// {
//     addChatMessage('æ²¡é”™æ²¡é”™ï¼Œè¿˜æœ‰ä¸€ä¸ªï¼Œç»§ç»­åŠ æ²¹å•Šï¼');                                                             
//     proStage4()     
// }

// function goProStage5()
// {
//     addChatMessage('å±…ç„¶å…¨éƒ½æ‰¾åˆ°äº†ï¼ŒçœŸæ˜¯åç”Ÿå¯ç•å•Š');                                                             
//     proStage5()     
// } 

function goNextStageP()
{
    console.log("proS:"+prostage)
    switch(prostage)
    {
        case 2:
            addChatMessage('å°±æ˜¯è¿™ç§é›¶ä»¶ï¼Œä½ å·²ç»å‘ç°ä¸€ä¸ªäº†ï¼ŒçœŸæ£’å•Šï¼è¿˜æœ‰ä¸¤ä¸ªé›¶ä»¶ï¼Œå¦‚æœä½ èƒ½æ‰¾åˆ°çš„è¯å°±å¤ªæ„Ÿè°¢ä½ äº†ï¼');                                                             
            proStage3() 
            prostage += 1;  
        break;
        case 3:
            addChatMessage('æ²¡é”™æ²¡é”™ï¼Œè¿˜æœ‰ä¸€ä¸ªï¼Œç»§ç»­åŠ æ²¹å•Šï¼');                                                             
            proStage4()  
            prostage += 1;   
        break;
        case 4:
            addChatMessage('å±…ç„¶å…¨éƒ½æ‰¾åˆ°äº†ï¼ŒçœŸæ˜¯åç”Ÿå¯ç•å•Šï¼');                                                             
            proStage5()  
            prostage += 1;  
        break;
    }
}

    // //æ¸¸æˆç»“æŸé€»è¾‘
    // if(getShootCount <= 0 )
    // {
    //     gameOver()
    // } 
    // else
    // {
    //     if()
    //     {

    //         gameOver();
    //     }
    //     if()
    //     {
                
    //         gameOver();
    //     }
        
        
    // }